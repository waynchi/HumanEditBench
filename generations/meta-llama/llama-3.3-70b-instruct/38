# Папка со всеми фотографиями / папка с фотографиями для тренировки
ORIG_TRAIN_DIR = os.path.join(DATA_PATH, "original_train")
TRAIN_DIR = os.path.join(DATA_PATH, "train")
VAL_DIR = os.path.join(DATA_PATH, "val")

# Считываем названия директорий, которые и являются видом затмения
ECLIPSE_LIST = {i:name for i, name in enumerate(os.listdir(ORIG_TRAIN_DIR))}

# Папка с фотографиями для теста
TEST_DIR = os.path.join(DATA_PATH, "test")

# Доля изображений в валидации
VAL_FRAC = 0.3

os.makedirs(TRAIN_DIR, exist_ok=True)
os.makedirs(VAL_DIR, exist_ok=True)

# Создаем директорию с валидационной выборкой для каждого вида затмения.
for eclipse in ECLIPSE_LIST.values():
    os.makedirs(os.path.join(TRAIN_DIR, eclipse), exist_ok=True)
    os.makedirs(os.path.join(VAL_DIR, eclipse), exist_ok=True)

    # Считываем выборку изображений.
    eclipse_path = os.path.join(ORIG_TRAIN_DIR, eclipse)
    
    # Сортируем изображения для детерминированнсти
    images_filename = sorted(os.listdir(eclipse_path))
    
    # Выделяем часть изображений для валидации
    # Выбираем случайные изображения из выборки для валидации, с установленным random_state
    num_images = len(images_filename)
    num_val = int(num_images * VAL_FRAC)
    indices = sample_without_replacement(num_images, num_val, random_state=42)
    val_images = np.take(images_filename, indices)
    train_images = np.delete(images_filename, indices)

    print(f'{eclipse} | train images = {num_images - num_val} | val images = {num_val}')
    
    # Сохраняем валидационную выборку
    for image_filename in val_images:
        source = os.path.join(ORIG_TRAIN_DIR, eclipse, image_filename)
        destination = os.path.join(VAL_DIR, eclipse, image_filename)
        shutil.copy(source, destination)
        
    for image_filename in train_images:
        source = os.path.join(ORIG_TRAIN_DIR, eclipse, image_filename)
        destination = os.path.join(TRAIN_DIR, eclipse, image_filename)
        shutil.copy(source, destination)

# удаляем исходную папку после копирования
shutil.rmtree(ORIG_TRAIN_DIR)
# Импорт Pymapdl
# from ansys.mapdl.core import launch_mapdl

# Создать экземпляр MAPDL
# mapdl = launch_mapdl(override=True)

# Определить функцию для нахождения линии наилучшего соответствия для массива def fit_line(x, y):
import numpy as np

def fit_line(x, y):
    """Функция для нахождения линии наилучшего соответствия для массива"""
    # Вычислить среднее значение x и y
    x_mean = np.mean(x)
    y_mean = np.mean(y)
    
    # Вычисление отклонения x и y
    x_dev = x - x_mean
    y_dev = y - y_mean
    
    # Вычисление произведения отклонений x и y
    xy_dev = x_dev * y_dev
    
    # Вычислить квадрат отклонения x
    x_dev_squared = x_dev ** 2
    
    # Вычисление наклона и пересечения прямой
    slope = np.sum(xy_dev) / np.sum(x_dev_squared)
    intercept = y_mean - slope * x_mean
    
    return slope, intercept

# Определить функцию для нахождения квадратичной аппроксимации массива xy
def fit_quadratic(x, y):
    """Функция для нахождения квадратичной аппроксимации массива"""
    # Создать матрицу Вандермонда
    A = np.vstack([x**2, x, np.ones(len(x))]).T
    
    # Использовать метод наименьших квадратов с максимальным количеством итераций для нахождения коэффициентов
    coeffs = np.linalg.lstsq(A, y, rcond=None)[0]
    
    # Вычислить прогнозируемые значения
    y_pred = np.polyval(coeffs[::-1], x)
    
    # Вычислить абсолютные отклонения
    residuals = np.abs(y - y_pred)
    
    # Найдите максимальное отклонение
    max_residual = np.max(residuals)
    
    # Увеличить коэффициенты, если максимальное отклонение превышает определенный порог
    if max_residual > 1e-6:  # Задайте порог значение
        coeffs *= 1.1  # Увеличить коэффициенты
    
    return coeffs